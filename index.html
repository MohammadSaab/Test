<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Task Management - Kanban</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { DEFAULT: 'rgb(0,174,141)', dark: 'rgb(0,150,122)', soft: 'rgba(0,174,141,.12)' }
          },
          boxShadow: { soft: '0 10px 30px rgba(2, 8, 23, .08)' }
        }
      }
    }
  </script>

  <style>
    html { scroll-behavior: smooth; }
    .dragging { opacity: .55; transform: rotate(-1deg); }
    .dropGlow { box-shadow: 0 0 0 3px rgba(0,174,141,.18); border-color: rgba(0,174,141,.5); }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">
  <div class="min-h-screen flex">

    <!-- Sidebar -->
    <aside class="hidden lg:flex lg:w-72 flex-col bg-white border-r border-slate-200">
      <div class="px-6 py-5 border-b border-slate-200">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-2xl bg-brand/10 flex items-center justify-center">
            <div class="h-5 w-5 rounded-md bg-brand"></div>
          </div>
          <div>
            <div class="text-sm text-slate-500">Workspace</div>
            <div class="font-semibold leading-tight">Task Management</div>
          </div>
        </div>
      </div>

      <nav class="p-4 space-y-1">
        <button class="w-full flex items-center gap-3 px-3 py-2 rounded-xl bg-brand/10 text-brand">
          <span class="h-2 w-2 rounded-full bg-brand"></span>
          <span class="font-medium">Kanban Board</span>
        </button>
        <button class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
          <span class="h-2 w-2 rounded-full bg-slate-300"></span>
          <span class="font-medium">My Tasks</span>
        </button>
        <button class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
          <span class="h-2 w-2 rounded-full bg-slate-300"></span>
          <span class="font-medium">Team</span>
        </button>
        <button class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
          <span class="h-2 w-2 rounded-full bg-slate-300"></span>
          <span class="font-medium">Reports</span>
        </button>
      </nav>

      <div class="mt-auto p-4">
        <div class="rounded-2xl bg-slate-50 border border-slate-200 p-4">
          <div class="text-sm font-semibold">Quick actions</div>
          <div class="text-xs text-slate-500 mt-1">Manage tasks efficiently</div>
          <button id="newTaskBtnSide" class="mt-3 w-full rounded-2xl bg-brand text-white px-4 py-2 font-medium hover:bg-brand-dark shadow-soft">
            + New Task
          </button>
        </div>
        <div class="text-[11px] text-slate-400 mt-3">
          Drag cards between columns to change status.
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1">
      <!-- Top bar -->
      <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
        <div class="px-4 sm:px-6 py-4 flex items-center gap-3">
          <button id="mobileMenuBtn" class="lg:hidden p-2 rounded-xl border border-slate-200 bg-white">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-slate-700">
              <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>

          <div class="flex-1">
            <div class="text-sm text-slate-500">Board</div>
            <h1 class="text-xl sm:text-2xl font-semibold">Kanban Tasks</h1>
          </div>

          <div class="hidden sm:flex items-center gap-2">
            <div class="relative">
              <input id="searchInput" class="w-72 rounded-2xl border border-slate-200 bg-white px-4 py-2 pl-10 outline-none focus:ring-2 focus:ring-brand/30"
                     placeholder="Search tasks..." />
              <svg class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M21 21l-4.3-4.3M17 10.5A6.5 6.5 0 1 1 4 10.5a6.5 6.5 0 0 1 13 0Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>

            <select id="priorityFilter" class="rounded-2xl border border-slate-200 bg-white px-3 py-2 outline-none focus:ring-2 focus:ring-brand/30">
              <option value="all">All priorities</option>
              <option value="High">High</option>
              <option value="Medium" selected>Medium</option>
              <option value="Low">Low</option>
            </select>

            <button id="newTaskBtn" class="rounded-2xl bg-brand text-white px-4 py-2 font-medium hover:bg-brand-dark shadow-soft">
              + New Task
            </button>
          </div>
        </div>

        <!-- Mobile controls -->
        <div class="sm:hidden px-4 pb-4 flex gap-2">
          <input id="searchInputMobile" class="flex-1 rounded-2xl border border-slate-200 bg-white px-4 py-2 outline-none focus:ring-2 focus:ring-brand/30"
                 placeholder="Search..." />
          <button id="newTaskBtnMobile" class="rounded-2xl bg-brand text-white px-4 py-2 font-medium hover:bg-brand-dark">
            + New
          </button>
        </div>
      </header>

      <div class="px-4 sm:px-6 py-6 space-y-5">
        <!-- Stats -->
        <section class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="bg-white rounded-3xl border border-slate-200 p-5 shadow-soft">
            <div class="text-sm text-slate-500">Open</div>
            <div id="statOpen" class="text-3xl font-semibold mt-1">0</div>
          </div>
          <div class="bg-white rounded-3xl border border-slate-200 p-5 shadow-soft">
            <div class="text-sm text-slate-500">In Progress</div>
            <div id="statProg" class="text-3xl font-semibold mt-1">0</div>
          </div>
          <div class="bg-white rounded-3xl border border-slate-200 p-5 shadow-soft">
            <div class="text-sm text-slate-500">Done</div>
            <div id="statDone" class="text-3xl font-semibold mt-1">0</div>
          </div>
          <div class="bg-white rounded-3xl border border-slate-200 p-5 shadow-soft">
            <div class="text-sm text-slate-500">Overdue</div>
            <div id="statOver" class="text-3xl font-semibold mt-1">0</div>
          </div>
        </section>

        <!-- Board -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <!-- Column: Open -->
          <div class="col rounded-3xl border border-slate-200 bg-white shadow-soft overflow-hidden"
               data-col="Open">
            <div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="h-2 w-2 rounded-full bg-slate-400"></span>
                <div class="font-semibold">Open</div>
                <span id="countOpen" class="ml-1 text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-600">0</span>
              </div>
              <button class="quickAdd text-sm font-medium text-brand hover:text-brand-dark" data-add="Open">+ Add</button>
            </div>
            <div id="colOpen" class="p-4 space-y-3 min-h-[220px]"></div>
          </div>

          <!-- Column: In Progress -->
          <div class="col rounded-3xl border border-slate-200 bg-white shadow-soft overflow-hidden"
               data-col="In Progress">
            <div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                <div class="font-semibold">In Progress</div>
                <span id="countProg" class="ml-1 text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-600">0</span>
              </div>
              <button class="quickAdd text-sm font-medium text-brand hover:text-brand-dark" data-add="In Progress">+ Add</button>
            </div>
            <div id="colProg" class="p-4 space-y-3 min-h-[220px]"></div>
          </div>

          <!-- Column: Done -->
          <div class="col rounded-3xl border border-slate-200 bg-white shadow-soft overflow-hidden"
               data-col="Done">
            <div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
                <div class="font-semibold">Done</div>
                <span id="countDone" class="ml-1 text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-600">0</span>
              </div>
              <button class="quickAdd text-sm font-medium text-brand hover:text-brand-dark" data-add="Done">+ Add</button>
            </div>
            <div id="colDone" class="p-4 space-y-3 min-h-[220px]"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Mobile drawer -->
  <div id="drawerBackdrop" class="hidden fixed inset-0 bg-black/30 z-40"></div>
  <div id="drawer" class="hidden fixed z-50 inset-y-0 left-0 w-80 bg-white border-r border-slate-200 shadow-soft">
    <div class="px-4 py-4 border-b border-slate-200 flex items-center justify-between">
      <div class="font-semibold">Menu</div>
      <button id="drawerClose" class="p-2 rounded-xl border border-slate-200">✕</button>
    </div>
    <div class="p-4 space-y-1">
      <button class="w-full text-left px-3 py-2 rounded-xl bg-brand/10 text-brand font-medium">Kanban Board</button>
      <button class="w-full text-left px-3 py-2 rounded-xl hover:bg-slate-50">My Tasks</button>
      <button class="w-full text-left px-3 py-2 rounded-xl hover:bg-slate-50">Team</button>
      <button class="w-full text-left px-3 py-2 rounded-xl hover:bg-slate-50">Reports</button>
    </div>
    <div class="p-4">
      <button id="newTaskBtnDrawer" class="w-full rounded-2xl bg-brand text-white px-4 py-2 font-medium hover:bg-brand-dark shadow-soft">
        + New Task
      </button>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="hidden fixed inset-0 bg-black/30 z-50"></div>
  <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="w-full max-w-xl bg-white rounded-3xl border border-slate-200 shadow-soft overflow-hidden">
      <div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between">
        <div class="font-semibold" id="modalTitle">New Task</div>
        <button id="modalClose" class="p-2 rounded-xl border border-slate-200 hover:bg-slate-50">✕</button>
      </div>

      <div class="p-5 space-y-4">
        <div>
          <label class="text-sm font-medium">Title</label>
          <input id="taskTitle" class="mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-brand/30"
                 placeholder="e.g., Prepare client demo deck" />
        </div>

        <div>
          <label class="text-sm font-medium">Description</label>
          <textarea id="taskDesc" rows="3" class="mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-brand/30"
                    placeholder="Optional notes..."></textarea>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div>
            <label class="text-sm font-medium">Status</label>
            <select id="taskStatus" class="mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-brand/30">
              <option value="Open">Open</option>
              <option value="In Progress">In Progress</option>
              <option value="Done">Done</option>
            </select>
          </div>

          <div>
            <label class="text-sm font-medium">Priority</label>
            <select id="taskPriority" class="mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-brand/30">
              <option value="High">High</option>
              <option value="Medium" selected>Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>

          <div>
            <label class="text-sm font-medium">Due date</label>
            <input id="taskDue" type="date" class="mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-brand/30" />
          </div>
        </div>

        <div class="flex items-center justify-between pt-2">
          <button id="deleteBtn" class="hidden text-red-600 hover:text-red-700 font-medium">Delete</button>
          <div class="flex gap-2 ml-auto">
            <button id="cancelBtn" class="rounded-2xl border border-slate-200 px-4 py-2 hover:bg-slate-50">Cancel</button>
            <button id="saveBtn" class="rounded-2xl bg-brand text-white px-4 py-2 font-medium hover:bg-brand-dark">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------- Storage --------
    const STORAGE_KEY = "tm_kanban_v1";
    const nowISO = () => new Date().toISOString();
    const todayYMD = () => new Date().toISOString().slice(0,10);

    function loadTasks() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "null"); }
      catch { return null; }
    }
    function saveTasks(list) { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    // -------- Seed demo --------
    function seedDemo() {
      const plusDays = (d) => {
        const dt = new Date();
        dt.setDate(dt.getDate() + d);
        return dt.toISOString().slice(0,10);
      };
      return [
        { id: crypto.randomUUID(), title: "Prepare demo plan", desc: "Outline agenda & scenarios.", status: "Open", priority: "High", due: plusDays(2), createdAt: nowISO() },
        { id: crypto.randomUUID(), title: "Update proposal timeline", desc: "Align milestones with delivery team.", status: "In Progress", priority: "Medium", due: plusDays(5), createdAt: nowISO() },
        { id: crypto.randomUUID(), title: "Review risks & assumptions", desc: "Confirm dependencies and exclusions.", status: "Open", priority: "Low", due: plusDays(10), createdAt: nowISO() },
        { id: crypto.randomUUID(), title: "Send follow-up email", desc: "Ask for API readiness & access.", status: "Done", priority: "Medium", due: plusDays(-1), createdAt: nowISO() },
      ];
    }

    let tasks = loadTasks();
    if (!Array.isArray(tasks) || tasks.length === 0) {
      tasks = seedDemo();
      saveTasks(tasks);
    }

    // -------- State --------
    let searchQuery = "";
    let priorityFilterValue = "Medium"; // matches default select; we'll change to "all" on load below
    let editingId = null;
    let quickStatusPreset = null;

    // -------- Elements --------
    const colOpen = document.getElementById("colOpen");
    const colProg = document.getElementById("colProg");
    const colDone = document.getElementById("colDone");

    const statOpen = document.getElementById("statOpen");
    const statProg = document.getElementById("statProg");
    const statDone = document.getElementById("statDone");
    const statOver = document.getElementById("statOver");

    const countOpen = document.getElementById("countOpen");
    const countProg = document.getElementById("countProg");
    const countDone = document.getElementById("countDone");

    const searchInput = document.getElementById("searchInput");
    const searchInputMobile = document.getElementById("searchInputMobile");
    const prioritySel = document.getElementById("priorityFilter");

    const newTaskBtn = document.getElementById("newTaskBtn");
    const newTaskBtnMobile = document.getElementById("newTaskBtnMobile");
    const newTaskBtnSide = document.getElementById("newTaskBtnSide");
    const newTaskBtnDrawer = document.getElementById("newTaskBtnDrawer");

    // Modal elements
    const modalBackdrop = document.getElementById("modalBackdrop");
    const modal = document.getElementById("modal");
    const modalClose = document.getElementById("modalClose");
    const cancelBtn = document.getElementById("cancelBtn");
    const saveBtn = document.getElementById("saveBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const modalTitle = document.getElementById("modalTitle");

    const taskTitle = document.getElementById("taskTitle");
    const taskDesc = document.getElementById("taskDesc");
    const taskStatus = document.getElementById("taskStatus");
    const taskPriority = document.getElementById("taskPriority");
    const taskDue = document.getElementById("taskDue");

    // Drawer
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const drawerBackdrop = document.getElementById("drawerBackdrop");
    const drawer = document.getElementById("drawer");
    const drawerClose = document.getElementById("drawerClose");

    // -------- Helpers --------
    const isOverdue = (t) => t.status !== "Done" && t.due && t.due < todayYMD();

    function escapeHtml(str) {
      return (str || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function badgeStatus(s) {
      if (s === "Done") return "bg-emerald-50 text-emerald-700 border-emerald-200";
      if (s === "In Progress") return "bg-amber-50 text-amber-700 border-amber-200";
      return "bg-slate-50 text-slate-700 border-slate-200";
    }

    function badgePriority(p) {
      if (p === "High") return "bg-red-50 text-red-700 border-red-200";
      if (p === "Medium") return "bg-blue-50 text-blue-700 border-blue-200";
      return "bg-slate-50 text-slate-700 border-slate-200";
    }

    function matchesFilters(t) {
      const q = (searchQuery || "").trim().toLowerCase();
      if (q) {
        const blob = `${t.title} ${t.desc} ${t.status} ${t.priority}`.toLowerCase();
        if (!blob.includes(q)) return false;
      }
      if (priorityFilterValue !== "all" && t.priority !== priorityFilterValue) return false;
      return true;
    }

    // -------- Render --------
    function renderStats() {
      const open = tasks.filter(t => t.status === "Open").length;
      const prog = tasks.filter(t => t.status === "In Progress").length;
      const done = tasks.filter(t => t.status === "Done").length;
      const over = tasks.filter(isOverdue).length;

      statOpen.textContent = open;
      statProg.textContent = prog;
      statDone.textContent = done;
      statOver.textContent = over;

      countOpen.textContent = open;
      countProg.textContent = prog;
      countDone.textContent = done;
    }

    function makeCard(t) {
      const overdue = isOverdue(t);

      const el = document.createElement("div");
      el.className = "taskCard rounded-2xl border border-slate-200 bg-white p-4 shadow-sm hover:shadow-soft transition cursor-grab active:cursor-grabbing";
      el.setAttribute("draggable", "true");
      el.dataset.id = t.id;

      el.innerHTML = `
        <div class="flex items-start justify-between gap-2">
          <div class="min-w-0">
            <div class="font-semibold truncate">${escapeHtml(t.title || "(Untitled)")}</div>
            <div class="text-sm text-slate-500 mt-1 line-clamp-2">${escapeHtml(t.desc || "")}</div>
          </div>

          <button class="editBtn shrink-0 rounded-xl border border-slate-200 px-2 py-1 text-sm hover:bg-slate-50" data-id="${t.id}">
            Edit
          </button>
        </div>

        <div class="mt-3 flex flex-wrap items-center gap-2 text-xs">
          <span class="inline-flex items-center px-2 py-1 rounded-full border ${badgeStatus(t.status)}">${escapeHtml(t.status)}</span>
          <span class="inline-flex items-center px-2 py-1 rounded-full border ${badgePriority(t.priority)}">${escapeHtml(t.priority)}</span>
          <span class="inline-flex items-center px-2 py-1 rounded-full border bg-white text-slate-600 border-slate-200">
            Due: <span class="ml-1 font-medium ${overdue ? "text-red-700" : "text-slate-800"}">${escapeHtml(t.due || "—")}</span>
          </span>
          ${overdue ? `<span class="inline-flex items-center gap-1 px-2 py-1 rounded-full border bg-red-50 text-red-700 border-red-200">
              <span class="h-1.5 w-1.5 rounded-full bg-red-500"></span> Overdue
            </span>` : ""}
        </div>
      `;

      // Drag events
      el.addEventListener("dragstart", (e) => {
        el.classList.add("dragging");
        e.dataTransfer.setData("text/plain", t.id);
        e.dataTransfer.effectAllowed = "move";
      });
      el.addEventListener("dragend", () => el.classList.remove("dragging"));

      return el;
    }

    function renderBoard() {
      colOpen.innerHTML = "";
      colProg.innerHTML = "";
      colDone.innerHTML = "";

      const filtered = tasks.filter(matchesFilters);

      for (const t of filtered) {
        const card = makeCard(t);
        if (t.status === "Open") colOpen.appendChild(card);
        else if (t.status === "In Progress") colProg.appendChild(card);
        else colDone.appendChild(card);
      }

      wireEditButtons();
    }

    function wireEditButtons() {
      document.querySelectorAll(".editBtn").forEach(btn => {
        btn.addEventListener("click", () => openModal(btn.dataset.id));
      });
    }

    function persistAndRender() {
      saveTasks(tasks);
      renderStats();
      renderBoard();
    }

    // -------- Column Drop Zones --------
    function setupDropZone(colEl, status) {
      colEl.addEventListener("dragover", (e) => {
        e.preventDefault();
        colEl.classList.add("dropGlow");
        e.dataTransfer.dropEffect = "move";
      });
      colEl.addEventListener("dragleave", () => colEl.classList.remove("dropGlow"));
      colEl.addEventListener("drop", (e) => {
        e.preventDefault();
        colEl.classList.remove("dropGlow");
        const id = e.dataTransfer.getData("text/plain");
        const t = tasks.find(x => x.id === id);
        if (!t) return;
        t.status = status;
        persistAndRender();
      });
    }

    // Make the inner list the drop zone (better UX)
    setupDropZone(colOpen, "Open");
    setupDropZone(colProg, "In Progress");
    setupDropZone(colDone, "Done");

    // -------- Modal --------
    function openModal(id = null, presetStatus = null) {
      editingId = id;
      quickStatusPreset = presetStatus;

      const isEdit = !!id;
      modalTitle.textContent = isEdit ? "Edit Task" : "New Task";
      deleteBtn.classList.toggle("hidden", !isEdit);

      if (isEdit) {
        const t = tasks.find(x => x.id === id);
        taskTitle.value = t?.title || "";
        taskDesc.value = t?.desc || "";
        taskStatus.value = t?.status || "Open";
        taskPriority.value = t?.priority || "Medium";
        taskDue.value = t?.due || "";
      } else {
        taskTitle.value = "";
        taskDesc.value = "";
        taskStatus.value = presetStatus || "Open";
        taskPriority.value = "Medium";
        taskDue.value = "";
      }

      modalBackdrop.classList.remove("hidden");
      modal.classList.remove("hidden");
      setTimeout(() => taskTitle.focus(), 50);
    }

    function closeModal() {
      modalBackdrop.classList.add("hidden");
      modal.classList.add("hidden");
      editingId = null;
      quickStatusPreset = null;
    }

    function validate() {
      const title = taskTitle.value.trim();
      if (!title) {
        taskTitle.focus();
        taskTitle.classList.add("ring-2", "ring-red-300");
        setTimeout(() => taskTitle.classList.remove("ring-2", "ring-red-300"), 700);
        return false;
      }
      return true;
    }

    saveBtn.addEventListener("click", () => {
      if (!validate()) return;

      const payload = {
        title: taskTitle.value.trim(),
        desc: taskDesc.value.trim(),
        status: taskStatus.value,
        priority: taskPriority.value,
        due: taskDue.value || ""
      };

      if (editingId) {
        const t = tasks.find(x => x.id === editingId);
        if (!t) return;
        Object.assign(t, payload);
      } else {
        tasks.unshift({
          id: crypto.randomUUID(),
          createdAt: nowISO(),
          ...payload
        });
      }

      persistAndRender();
      closeModal();
    });

    deleteBtn.addEventListener("click", () => {
      if (!editingId) return;
      tasks = tasks.filter(t => t.id !== editingId);
      persistAndRender();
      closeModal();
    });

    modalClose.addEventListener("click", closeModal);
    cancelBtn.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", closeModal);

    // -------- Controls: Search + Priority --------
    function setSearch(v) {
      searchQuery = v || "";
      renderBoard();
    }

    searchInput?.addEventListener("input", () => setSearch(searchInput.value));
    searchInputMobile?.addEventListener("input", () => {
      setSearch(searchInputMobile.value);
      if (searchInput) searchInput.value = searchInputMobile.value;
    });

    // Set default to "all" (more useful)
    priorityFilterValue = "all";
    if (prioritySel) prioritySel.value = "all";
    prioritySel?.addEventListener("change", () => {
      priorityFilterValue = prioritySel.value;
      renderBoard();
    });

    // -------- New task buttons --------
    function openNew() { openModal(null, "Open"); }
    newTaskBtn?.addEventListener("click", openNew);
    newTaskBtnMobile?.addEventListener("click", openNew);
    newTaskBtnSide?.addEventListener("click", openNew);
    newTaskBtnDrawer?.addEventListener("click", () => { closeDrawer(); openNew(); });

    // Quick add per column
    document.querySelectorAll(".quickAdd").forEach(btn => {
      btn.addEventListener("click", () => openModal(null, btn.dataset.add));
    });

    // -------- Drawer --------
    function openDrawer() {
      drawerBackdrop.classList.remove("hidden");
      drawer.classList.remove("hidden");
    }
    function closeDrawer() {
      drawerBackdrop.classList.add("hidden");
      drawer.classList.add("hidden");
    }

    mobileMenuBtn?.addEventListener("click", openDrawer);
    drawerClose?.addEventListener("click", closeDrawer);
    drawerBackdrop?.addEventListener("click", closeDrawer);

    // -------- Init render --------
    persistAndRender();
  </script>
</body>
</html>
